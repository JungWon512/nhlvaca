<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.auc.lalm.bs.service.Impl.LALM0113Mapper">
    
    <update id="LALM0113_updCusRlno">
        update TB_LA_IS_MM_MWMN set cus_rlno = frlno
	     where (cus_rlno = '' or cus_rlno is null)
	       and na_bzplc = #{ss_na_bzplc}
    </update>
    
    <select id="LALM0113_selListGrd_MmMwmn" resultType="HashMap">
        select
		       na_bzplc
		     , trmn_amnno
		     , mwmn_na_trpl_c
		     , CASE WHEN #{ss_security} = '1'   THEN sra_mwmnnm
		            WHEN LENGTH(sra_mwmnnm) = 2 THEN SUBSTR(sra_mwmnnm,1,1) || '*' 
		            WHEN LENGTH(sra_mwmnnm) = 3 THEN SUBSTR(sra_mwmnnm,1,1) || '*'  || SUBSTR(sra_mwmnnm,3,1) 
		            WHEN LENGTH(sra_mwmnnm) = 4 THEN SUBSTR(sra_mwmnnm,1,1) || '**' || SUBSTR(sra_mwmnnm,4,1)  
		            WHEN LENGTH(sra_mwmnnm) >= 5 THEN SUBSTR(sra_mwmnnm,1,2) || '**' || SUBSTR(sra_mwmnnm,5,LENGTH(sra_mwmnnm))  END AS sra_mwmnnm  /* 축산중도매인명                        */
		     , frlno
		     , zip
		     , dongup
		     , CASE WHEN #{ss_security} = '1' THEN dongbw
		            ELSE LPAD(' ', LENGTH(dongbw), '*') END dongbw      /*  동이하주소                            */
		     , CASE WHEN #{ss_security} = '1'                          THEN ohse_telno
		            WHEN LENGTH(REPLACE(trim(ohse_telno),'-','')) = 9  THEN SUBSTR(REPLACE(trim(ohse_telno),'-',''),1,2) || '-***-' || SUBSTR(REPLACE(trim(ohse_telno),'-',''),6,4)  
		            WHEN LENGTH(REPLACE(trim(ohse_telno),'-','')) = 10 THEN (CASE WHEN SUBSTR(REPLACE(trim(ohse_telno),'-',''),1,2) = '02' 
		                                                                          THEN SUBSTR(REPLACE(trim(ohse_telno),'-',''),1,2) || '-****-' || SUBSTR(REPLACE(trim(ohse_telno),'-',''),7,4)  
		                                                                          ELSE SUBSTR(REPLACE(trim(ohse_telno),'-',''),1,3) || '-***-' || SUBSTR(REPLACE(trim(ohse_telno),'-',''),7,4)  END) 
		            WHEN LENGTH(REPLACE(trim(ohse_telno),'-','')) = 11 THEN SUBSTR(REPLACE(trim(ohse_telno),'-',''),1,3) || '-****-' || SUBSTR(REPLACE(trim(ohse_telno),'-',''),8,4)
		            WHEN LENGTH(REPLACE(trim(ohse_telno),'-','')) <![CDATA[<]]> 9  THEN '***-' || SUBSTR(REPLACE(trim(ohse_telno),'-',''),4,4)                                                                           
		            END  AS ohse_telno       /* 자택전화번호               */
		     , CASE WHEN #{ss_security} = '1'                         THEN cus_mpno
		            WHEN LENGTH(REPLACE(RTRIM(cus_mpno),'-','')) = 9  THEN SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),1,2) || '-***-' || SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),6,4)  
		            WHEN LENGTH(REPLACE(RTRIM(cus_mpno),'-','')) = 10 THEN 
		           (CASE WHEN SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),1,2) = '02' 
		                 THEN SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),1,2) || '-****-' || SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),7,4)
		            ELSE SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),1,3) || '-***-' || SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),7,4)  END) 
		            WHEN LENGTH(REPLACE(RTRIM(cus_mpno),'-','')) IN (11,12) THEN SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),1,3) || '-****-' || SUBSTR(REPLACE(RTRIM(cus_mpno),'-',''),8,4)                                             
		       END AS cus_mpno                                    /*  핸드폰번호                     */
		     , maco_yn
		     , jrdwo_dsc
		     , psn_inf_ofr_agr_yn
		     , tms_yn
		     , del_yn
		     , fsrg_dtm
		     , fsrgmn_eno
		     , lschg_dtm
		     , ls_cmeno
		     , rmk_cntn
		     , Replace(cus_rlno,'-','') AS cus_rlno
		     , sra_mwmnnm               as org_sra_mwmnnm
		     , dongbw                   as org_dongbw
		     , ohse_telno               as org_ohse_telno
		     , cus_mpno                 as org_cus_mpno
		    from tb_la_is_mm_mwmn
		    where na_bzplc   = #{ss_na_bzplc}
		    and   sra_mwmnnm like '%' || #{sr_sra_mwmnnm} || '%'
		    and   del_yn     = '0';
    </select>
    
    <select id="LALM0113_selListFrm_MmMwmn" resultType="HashMap">
	    select
	       na_bzplc
	     , trmn_amnno
	     , mwmn_na_trpl_c
	     , sra_mwmnnm
	     , frlno
	     , zip
	     , dongup
	     , dongbw
	     , ohse_telno
	     , cus_mpno
	     , maco_yn
	     , jrdwo_dsc
	     , psn_inf_ofr_agr_yn
	     , tms_yn
	     , del_yn
	     , fsrg_dtm
	     , fsrgmn_eno
	     , lschg_dtm
	     , ls_cmeno
	     , rmk_cntn
	     , Replace(cus_rlno,'-','') AS cus_rlno 
	    from tb_la_is_mm_mwmn
	    where na_bzplc   = #{ss_na_bzplc}
	    and   trmn_amnno = #{trmn_amnno}
    </select>
    
    <select id="LALM0113_vTrmnAmnno" resultType="_int">
        select NVL(max(trmn_amnno)+1,1) from tb_la_is_mm_mwmn where na_bzplc = #{ss_na_bzplc}
    </select>
    
    <insert id="LALM0113_insTrmn">
        insert into tb_la_is_mm_mwmn(
              na_bzplc
            , trmn_amnno
            , mwmn_na_trpl_c
            , sra_mwmnnm
            , frlno
            , zip
            , dongup
            , dongbw
            , ohse_telno
            , cus_mpno
            , maco_yn
            , jrdwo_dsc
            , psn_inf_ofr_agr_yn
            , tms_yn
            , del_yn
            , fsrg_dtm
            , fsrgmn_eno
            , lschg_dtm
            , ls_cmeno
            , rmk_cntn
            , cus_rlno
        )
        values (
              #{ss_na_bzplc}
            , #{v_trmn_amnno}
            , #{mwmn_na_trpl_c}
            , #{sra_mwmnnm}
            , #{frlno}
            , replace(#{zip},'-','')
            , #{dongup}
            , #{dongbw}
            , #{ohse_telno}
            , #{cus_mpno}
            , #{maco_yn}
            , #{jrdwo_dsc}
            , #{psn_inf_ofr_agr_yn}
            , '0'                                      /* 미전송   */
            , '0'                                      /* 미삭제   */
            , SYSDATE
            , #{ss_userid}
            , SYSDATE
            , #{ss_userid}
            , #{rmk_cntn}
            , #{cus_rlno}
        )
    </insert>
    
    <insert id="LALM0113_TrmnInsMiMwmn">
        insert into tb_la_is_mi_mwmn(
              na_bzplc
            , trmn_amnno
            , mwmn_na_trpl_c
            , sra_mwmnnm
            , frlno
            , zip
            , dongup
            , dongbw
            , ohse_telno
            , cus_mpno
            , maco_yn
            , jrdwo_dsc
            , psn_inf_ofr_agr_yn
            , tms_yn
            , del_yn
            , fsrg_dtm
            , fsrgmn_eno
            , lschg_dtm
            , ls_cmeno
            , rmk_cntn
        )
        select
              na_bzplc
            , trmn_amnno
            , mwmn_na_trpl_c
            , sra_mwmnnm
            , frlno
            , zip
            , dongup
            , dongbw
            , ohse_telno
            , cus_mpno
            , maco_yn
            , jrdwo_dsc
            , psn_inf_ofr_agr_yn
            , tms_yn
            , del_yn
            , fsrg_dtm
            , fsrgmn_eno
            , lschg_dtm
            , ls_cmeno
            , rmk_cntn
        from  tb_la_is_mm_mwmn
        where na_bzplc   = #{ss_na_bzplc}
        and   trmn_amnno = #{trmn_amnno}
    </insert>
    
    <update id="LALM0113_updTrmn">
        update tb_la_is_mm_mwmn set
              mwmn_na_trpl_c         = #{mwmn_na_trpl_c}
            , sra_mwmnnm             = #{sra_mwmnnm}
            , frlno                  = #{frlno}
            , zip                    = replace(#{zip},'-','')
            , dongup                 = #{dongup}
            , dongbw                 = #{dongbw}
            , ohse_telno             = #{ohse_telno}
            , cus_mpno               = #{cus_mpno}
            , maco_yn                = #{maco_yn}
            , jrdwo_dsc              = #{jrdwo_dsc}
            , psn_inf_ofr_agr_yn     = #{psn_inf_ofr_agr_yn}
            , tms_yn                 = '0'
            , del_yn                 = '0'
            , lschg_dtm              = SYSDATE
            , ls_cmeno               = #{ss_userid}
            , rmk_cntn               = #{rmk_cntn}
            , cus_rlno               = #{cus_rlno}
        where na_bzplc               = #{ss_na_bzplc}
        and   trmn_amnno             = #{trmn_amnno}
    </update>
    
    <update id="LALM0113_delTrmn">
        update tb_la_is_mm_mwmn set
	          tms_yn                 = '0'
	        , del_yn                 = '1'
	        , lschg_dtm              = SYSDATE
	        , ls_cmeno               = #{ss_userid}
	    where na_bzplc               = #{ss_na_bzplc}
	    and   trmn_amnno             = #{trmn_amnno}
    </update>
    
    <select id="LALM0113_selDetail" resultType="HashMap">
        select
               na_bzplc
             , trmn_amnno
             , mwmn_na_trpl_c
             , sra_mwmnnm  /* 축산중도매인명                        */
             , frlno
             , zip
             , dongup
             , dongbw      /*  동이하주소                            */
             , ohse_telno       /* 자택전화번호               */
             , cus_mpno                                    /*  핸드폰번호                     */
             , maco_yn
             , jrdwo_dsc
             , psn_inf_ofr_agr_yn
             , tms_yn
             , del_yn
             , fsrg_dtm
             , fsrgmn_eno
             , lschg_dtm
             , ls_cmeno
             , rmk_cntn
             , Replace(cus_rlno,'-','') AS cus_rlno
             , sra_mwmnnm               as org_sra_mwmnnm
             , dongbw                   as org_dongbw
             , ohse_telno               as org_ohse_telno
             , cus_mpno                 as org_cus_mpno
            from tb_la_is_mm_mwmn
            where na_bzplc   = #{ss_na_bzplc}
            and   trmn_amnno = #{trmn_amnno}
            and   del_yn     = '0'
    </select>
   
</mapper>














